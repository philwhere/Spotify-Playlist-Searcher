function SetupAuthorization(accessToken,refreshToken,tokenExpiry){localStorage.setItem("access_token",accessToken);localStorage.setItem("refresh_token",refreshToken);localStorage.setItem("token_expiry",tokenExpiry)}async function EnsureTokenIsFresh(){const now=(new Date).valueOf(),expiryWithBufferSubtracted=GetAccessTokenExpiry()-3e5,tokenIsAlive=expiryWithBufferSubtracted>now;tokenIsAlive||await RefreshToken()}async function RefreshToken(){return ShowLoader("Refreshing session..."),await fetch(`/api/spotify/token?refreshToken=${GetRefreshToken()}`).then(response=>response.json()).then(json=>{HideLoader(),SetupAuthorization(json.access_token,GetRefreshToken(),CalculateExpiryInUnixMs(json.expires_in))}).catch(error=>{window.location.href="/";throw error;})}function Logout(){const spotifyLogoutWindow=window.open("https://accounts.spotify.com/en/logout","Spotify Logout","width=700,height=500,top=40,left=40");setTimeout(()=>{spotifyLogoutWindow.close(),localStorage.clear(),window.location.href="/"},2e3)}const GetAccessToken=()=>localStorage.getItem("access_token"),GetRefreshToken=()=>localStorage.getItem("refresh_token"),GetAccessTokenExpiry=()=>parseInt(localStorage.getItem("token_expiry"));$("#logoutButton").click(()=>Logout());