function ShowLoader(message){$("#loader").hasClass("hidden")&&$("#loader").toggleClass("hidden");$("#loaderMessage").text(message)}function HideLoader(){$("#loader").hasClass("hidden")||$("#loader").toggleClass("hidden")}function GetUrlParams(){const params={};for(const param of GlobalUrlParams)params[param[0]]=param[1];return params}function CalculateExpiryInUnixMs(expiresInSeconds){return(new Date).valueOf()+expiresInSeconds*1e3-1e3}function PrettyPrintElapsedTime(elapsedSeconds){const seconds=Math.floor(elapsedSeconds),hours=Math.floor(seconds/3600),minutes=Math.floor(seconds/60),minutesAfterHours=Math.floor((seconds-hours*3600)/60),secondsAfterMinutes=seconds-hours*3600-minutesAfterHours*60,hoursMessage=`${hours} ${hours===1?"hour":"hours"}`,minutesMessage=`${minutesAfterHours} ${minutesAfterHours===1?"minute":"minutes"}`,secondsMessage=`${secondsAfterMinutes} ${secondsAfterMinutes===1?"second":"seconds"}`;return hours>0?`${hoursMessage} ${minutesMessage}`:minutes>0?`${minutesMessage}`:secondsMessage}function SetupAuthorization(accessToken,refreshToken,tokenExpiry){localStorage.setItem("access_token",accessToken);localStorage.setItem("refresh_token",refreshToken);localStorage.setItem("token_expiry",tokenExpiry)}async function EnsureTokenIsFresh(){const offsetNowDate=(new Date).valueOf()-3e5,needsRefreshing=GetAccessTokenExpiry()<offsetNowDate;needsRefreshing&&await RefreshToken()}async function RefreshToken(){return ShowLoader("Refreshing session..."),await fetch(`/api/spotify/token?refreshToken=${GetRefreshToken()}`).then(response=>response.json()).then(json=>{HideLoader(),SetupAuthorization(json.access_token,GetRefreshToken(),CalculateExpiryInUnixMs(json.expires_in))}).catch(error=>{window.location.href="/";throw error;})}function Logout(){const spotifyLogoutWindow=window.open("https://accounts.spotify.com/en/logout","Spotify Logout","width=700,height=500,top=40,left=40");setTimeout(()=>{spotifyLogoutWindow.close(),localStorage.clear(),window.location.href="/"},2e3)}const GlobalUrlParams=new URLSearchParams(window.location.search);const GetAccessToken=()=>localStorage.getItem("access_token"),GetAccessTokenExpiry=()=>localStorage.getItem("token_expiry"),GetRefreshToken=()=>localStorage.getItem("refresh_token");$("#logoutButton").click(()=>Logout());