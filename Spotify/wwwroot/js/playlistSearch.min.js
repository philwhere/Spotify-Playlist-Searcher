function GetTimeRemaining(n){const t=Date.parse(n)-Date.parse(new Date),i=Math.floor(t/1e3%60),r=Math.floor(t/6e4%60),u=Math.floor(t/36e5%24),f=Math.floor(t/864e5);return{total:t,days:f,hours:u,minutes:r,seconds:i}}function InitializeClock(n,t){function f(){const n=GetTimeRemaining(t);r.innerHTML=("0"+n.minutes).slice(-2);u.innerHTML=("0"+n.seconds).slice(-2);n.total<=0&&(r.innerHTML="00",u.innerHTML="00")}const i=document.getElementById(n),r=i.querySelector(".minutes"),u=i.querySelector(".seconds");f();GlobalCounting=setInterval(f,1e3)}function ResetClock(n,t){clearInterval(GlobalCounting);InitializeClock(n,t)}function Search(){const n=$("#searchbar").val();if(n.length>0){const t=GlobalPlaylists.filter(t=>t.songs.items.find(t=>GetMatch(t.track,n)));ShowResults(t,n);ListenForRemoveClicks()}}function ShowResults(n,t){$("#tableBody").empty();$(n).each((n,i)=>{const r=i.songs.items,u=r.filter(n=>GetMatch(n.track,t)),f=ConstructRow(i,u);$("#tableBody").append(f)});n.length>0&&$("#tablePanel").removeClass("hidden")}function ConstructRow(n,t){let i="",r="",u=`<tr>
                        <td class="text-center">${n.name}</td>`;return $(t).each((t,u)=>{i+=`<p>${u.track.artistsString}</p>`,r+=`<p class="song" playlistId="${n.id}" uri="${u.track.uri}">${u.track.name}</p>`}),u+`    <td>${i}</td>
                        <td>${r}</td>
                    </tr>`}function GetMatch(n,t){return $("#selectedSearchOption").text().includes("Song")?PartialMatch(n.name,t):$("#selectedSearchOption").text().includes("Artist")?PartialMatch(n.artistsString,t):PartialMatch(n.name,t)||PartialMatch(n.artistsString,t)}function PartialMatch(n,t){return n.toLowerCase().includes(t.toLowerCase().trim())}function TriggerRemoval(n,t){const i=GlobalPlaylists.find(t=>t.id===n),r=i.songs.items.find(n=>n.track.uri===t).track,u=confirm(`Do you want to remove "${r.name}" by "${r.artistsString}" from "${i.name}"?`);u&&RemoveFromServer(RemoveSongFromLocal,n,t)}function RemoveFromServer(n,t,i){$.ajax({url:`/api/spotify/playlists/${t}/tracks/${i}`,type:"delete",headers:{Authorization:`Bearer ${GlobalAccesssToken}`},beforeSend:function(){ShowLoader()}}).fail(function(){alert("Delete exploded")}).done(function(){n(t,i)}).always(function(){HideLoader()})}function RemoveSongFromLocal(n,t){const i=GlobalPlaylists.findIndex(t=>t.id===n);_.remove(GlobalPlaylists[i].songs.items,n=>n.track.uri===t);Search()}function GetNewAuthByRefreshToken(n){$.ajax({url:`/api/spotify/token?refresh_token=${UrlParams.get("refresh_token")}`,type:"get",beforeSend:function(){ShowLoader()}}).fail(function(){alert("Refresh exploded");HideLoader()}).done(function(t){n(t)})}function UpdateClockAndAccessToken(n){const t=CalculateUnixInMsExpiry(n.expires_in);ResetClock("clockdiv",new Date(t));GlobalAccesssToken=n.access_token;HideLoader()}function UpdatePageWithNewAccess(n){const t=CalculateUnixInMsExpiry(n.expires_in);UrlParams.set("expiry",t);UrlParams.set("access_token",n.access_token);window.location.search=UrlParams.toString()}function ListenForRemoveClicks(){$(".song").click(function(){const n=$(this).attr("playlistId"),t=$(this).attr("uri");TriggerRemoval(n,t)})}function LoadInitialClock(){const n=parseInt(UrlParams.get("expiry"));InitializeClock("clockdiv",new Date(n))}var GlobalCounting,GlobalAccesssToken=UrlParams.get("access_token");$(document).ready(function(){LoadInitialClock();$("#searchbar").keyup(()=>Search());$("#searchOptions li").click(n=>{const t=n.currentTarget.innerText;$("#selectedSearchOption").html(`${t} <span class="caret"></span>`);Search()});$("#refreshDataButton").click(()=>GetNewAuthByRefreshToken(UpdatePageWithNewAccess));$("#refreshTokenButton").click(()=>GetNewAuthByRefreshToken(UpdateClockAndAccessToken))});