@using System.Text.Encodings.Web
@{
    ViewData["Title"] = "Home";
}

@section Scripts
    {
    <script>
        $(document).ready(function () {
            const params = GetAllParams();
            if (!params.code) {
                ShowLoader();
                window.location = 'https://accounts.spotify.com/authorize?client_id=@(ViewBag.ClientId)&redirect_uri=@(GetEncodedRedirectUri())&scope=playlist-read-private%20playlist-modify-public%20playlist-modify-private&response_type=code'
            }
            else {
                ShowLoader();
                window.location = `/home/authcoderedirect?code=${params.code}&redirect_uri=@(GetEncodedRedirectUri())`;
            }
        });
    </script>
}

@functions {
string GetEncodedRedirectUri()
{
    string baseUrl = $"{Context.Request.Scheme}://{Context.Request.Host}/";
    return UrlEncoder.Default.Encode(baseUrl);
}
}
